{"version":3,"sources":["app/adminSlice.ts","app/articlesSlice.ts","app/store.ts","app/hooks.ts","secrets.js","utils/intoParsable.js","utils/preprocessMarkdown.ts","components/Article/MarkdownRender.tsx","pages/Admin/Editors/NoticeBanner.tsx","utils/functions.ts","utils/DOMIntoMarkdown.js","pages/Admin/Editors/RichTextEditWidgetInformation.tsx","components/Form/Button.tsx","pages/Admin/Editors/RichTextEditor.tsx","pages/Admin/Admin.tsx","components/Article/Article.tsx","utils/search.js","components/Searchbar/Searchbar.tsx","pages/Header/Search.tsx","pages/Header/Header.tsx","pages/Homepage/Homepage.tsx","pages/Index/IndexPage.tsx","components/Form/Input.tsx","components/Form/Form.tsx","App.tsx","index.tsx","pages/Header/Header.module.scss","components/Article/Article.module.scss","components/Form/Input.module.scss","pages/Admin/Editors/NoticeBanner.module.scss","pages/Admin/Editors/richWidgetBar.module.scss","pages/Header/Search.module.scss","components/Searchbar/Searchbar.module.scss","pages/Homepage/Homepage.module.scss","components/Form/Button.module.scss","App.module.scss","pages/Admin/Editors/bottomToolbar.module.scss"],"names":["LoginType","registerAccount","information","a","databaseApi","application","emailPasswordAuth","registerUser","email","password","loginWith","credentials","Credentials","emailPassword","anonymous","user","undefined","logIn","type","User","Anonymous","applicationUser","loginWithEmailAndPassword","createAsyncThunk","accountDetails","possiblyAdminLoginType","customData","status","Admin","adminSlice","createSlice","name","initialState","loginType","reducers","logout","state","NotLoggedIn","extraReducers","builder","addCase","fulfilled","action","payload","actions","selectSelf","admin","selectLoginType","createDraftSafeSelector","tryToCallWithUser","fn","argument","thunkApi","Error","console","error","rejectWithValue","response","data","initApi","appId","getState","dispatch","App","id","queryForArticles","query","functions","getAllArticles","deleteArticle","removeArticle","insertArticle","articleContent","createOrUpdateArticle","articlesSlice","articlesData","articles","pending","rejected","selectStatus","selectArticlesData","persistConfig","key","storage","whitelist","rootReducer","combineReducers","articlesReducer","adminReducer","persistedReducer","persistReducer","store","configureStore","reducer","middleware","getDefaultMiddleware","serializableCheck","ignoredActions","FLUSH","REHYDRATE","PAUSE","PERSIST","PURGE","REGISTER","ignoredPaths","persistor","persistStore","useAppDispatch","useDispatch","useAppSelector","useSelector","Secrets","intoParsable","input","current_character_index","still_parsing","length","peek_character","look_ahead_offset","eat_character","result","withPreservedPosition","progn_fn","restoration_index","stillParsing","peekCharacter","requireCharacter","character","eatCharacter","consumeUntil","ending_predicate_fn","tryParseString","parsable","delimiter","acceptMultiline","successful_parse","string_contents","eatIdentifier","c","eatWhitespace","log","preprocessMarkdown","stringInput","actualResult","processed","imageLinks","headers","nextCharacter","has_end","inbetween","image_tag","property","maybe_string","push","value_identifier","headerCount","textContents","level","text","md","MD","html","breaks","linkify","typographer","renderMarkdown","render","MarkdownRender","className","children","dangerouslySetInnerHTML","__html","NoticeBanner","dirtyFlag","styles","noticeBannerStyles","dropOut","dropIn","useState","selfDirtyFlag","updateSelfDirtyFlag","style","updateStyle","main","validPageLink","originalName","toLowerCase","trim","replace","image_name","form_data","FormData","append","requestUrl","fetch","method","body","res","json","imageFile","whenRetrieved","image_file","img","document","createElement","src","URL","createObjectURL","onload","canvas","canvas_context","getContext","width","height","drawImage","imgData","toDataURL","split","dictionaryUpdateKeyNested","dictionary","keys","updateFunction","shallowClone","slice","newDictionary","dictionaryUpdateKey","surrounder","sym","content","spacesLeft","spacesRight","i","repeat","surrounders","renderElement","root","text_contents","tagName","parentElement","Number","Array","from","reduce","accumulator","listItem","childText","renderDomAsMarkdown","getAttribute","nodeType","textContent","hasChildNodes","childNodes","output","node","widgets","heading","active","types","h1","display","command","category","h2","h3","h4","h5","h6","image","list","orderedList","unorderedList","bold","italic","underline","Button","styleOption","props","button","executeRichTextCommand","commandName","optionalArgument","fileDialog","click","addEventListener","fileHandlerOnChange","execCommand","queryRichTextCommand","wantedValue","queryCommandValue","queryCommandState","probablyFile","target","files","retrieveImageData","uploadImage","then","imgURL","success","url","editorHandleKeybindings","saveDocument","toggleWidget","updateDirtyFlag","event","shiftKey","disableDefaultBehavior","ctrlKey","preventDefault","stopPropagation","editModeInlineStyle","borderColor","borderWidth","margin","borderStyle","RichTextEditor","submissionHandler","currentArticle","toggleDraftStatus","initialArticleState","editableTitleDOMRef","useRef","editableAreaDOMRef","widgetStates","updateWidgetState","current","markdownText","innerHTML","_toggleWidgetActiveState","widgetId","categoryValue","currentlyActive","toggleWidgetActiveState","richWidgetBarStyle","Object","entries","value","copy","map","widget","onClick","_","title","contentEditable","ref","articleStyles","article","onSelect","newWidgetState","onKeyDown","bottomToolbarStyle","draftStatus","updateDraftStatus","submissionData","onFinishedCallback","TableOfContents","sectionHeaders","border","padding","marginLeft","href","ArticleComponent","history","useHistory","isAdmin","adminEditView","updateAdminEditView","processedMarkdown","approximateSearch","sort","matched_characters","b","count","shorter_length","Math","min","toUpperCase","x","y","matched","Searchbar","returnInput","setInput","lastTimeTyping","Date","getTime","searchbar","autoFocus","placeholder","onChange","e","setTimeout","clearDiv","clear","focus","renderHoverboxSearch","searchResults","hoverBox","to","Search","searchFunction","renderFunction","searchResult","setSearchResult","Header","currentLoginType","header","logoDiv","navbar","menu","links","ArticleShowcase","array","floor","random","articleDisplay","substr","replaceAll","Homepage","IndexPage","index","filter","Input","changeHandler","label","defaultValue","option","readOnly","selectAllOnFocus","InputOrTextarea","inputRef","group","textarea","onFocus","select","shrink","Form","submitFn","inputItems","defaultItems","assign","submitHandler","onSubmit","idx","RegisterPage","required","passwordConfirmation","alert","LoginPage","loginResult","exact","path","Article","InitializingApp","useEffect","ReactDOM","StrictMode","basename","getElementById","module","exports"],"mappings":"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","file":"static/js/main.7955af97.chunk.js","sourcesContent":["import { createSlice, createDraftSafeSelector, PayloadAction, createAsyncThunk } from '@reduxjs/toolkit';\r\nimport { RootState } from 'app/store';\r\n\r\nimport { Credentials } from \"realm-web\";\r\nimport { databaseApi } from 'app/articlesSlice';\r\n\r\nexport enum LoginType {\r\n  NotLoggedIn,\r\n  Anonymous,\r\n  User,\r\n  Admin,\r\n}\r\n\r\nexport interface AccountDetails {\r\n  email: string;\r\n  password: string;\r\n}\r\n\r\nexport interface LoginAttemptResult {\r\n  type: LoginType,\r\n  accountDetails?: AccountDetails,\r\n}\r\n\r\ninterface ApplicationState {\r\n  loginType: LoginType | null,\r\n  accountDetails: AccountDetails,\r\n}\r\n\r\nconst initialState: ApplicationState = {\r\n  loginType: null,\r\n  accountDetails: {\r\n    email: '',\r\n    password: '',\r\n  }\r\n};\r\n\r\nexport async function registerAccount(information: AccountDetails) {\r\n  await databaseApi.application?.emailPasswordAuth.registerUser(information.email, information.password);\r\n}\r\n\r\nexport async function loginWith(information?: AccountDetails) {\r\n  const credentials = (!information)\r\n    ? Credentials.anonymous()\r\n    : Credentials.emailPassword(information.email, information.password);\r\n\r\n  let user = undefined;\r\n  try {\r\n    user = await databaseApi.application?.logIn(credentials);\r\n    return { type: LoginType.User, user };\r\n  } catch (error) {\r\n    user = await databaseApi.application?.logIn(Credentials.anonymous());\r\n    return { type: LoginType.Anonymous, user };\r\n  } finally {\r\n    databaseApi.applicationUser = user;\r\n  }\r\n}\r\n\r\nexport const loginWithEmailAndPassword = createAsyncThunk(\r\n  'admin/loginWithEmailAndPassword',\r\n  async (accountDetails: AccountDetails) => {\r\n    const {type, user} = await loginWith(accountDetails);\r\n\r\n    if (type !== LoginType.Anonymous) {\r\n      const possiblyAdminLoginType = \r\n        (user?.customData.status) === \"admin\" ? LoginType.Admin : false;\r\n      return {\r\n        accountDetails,\r\n        type: possiblyAdminLoginType || type,\r\n      };\r\n    }\r\n\r\n    return { type };\r\n  }\r\n)\r\n\r\nconst adminSlice = createSlice({\r\n  name: 'admin',\r\n  initialState,\r\n  reducers: {\r\n    logout: (state) => {\r\n      state.loginType = LoginType.NotLoggedIn;\r\n    },\r\n  },\r\n  extraReducers: (builder) => {\r\n    builder.addCase(\r\n      loginWithEmailAndPassword.fulfilled,\r\n      (state, action) => {\r\n        const payload = action.payload;\r\n\r\n        switch (payload.type) {\r\n          case LoginType.User:\r\n          case LoginType.Admin:\r\n            /*\r\n              are there constraints in typescript? I know by this\r\n              point my login object has stuff, so I shouldn't have to check...\r\n            */\r\n            if (payload.accountDetails)\r\n              state.accountDetails = payload.accountDetails;\r\n            state.loginType = payload.type;\r\n          break;\r\n          default: break;\r\n        }\r\n      }\r\n    )\r\n  }\r\n});\r\n\r\nexport const { logout, } = adminSlice.actions;\r\nexport default adminSlice.reducer;\r\n\r\nconst selectSelf = (state: RootState) => state.admin;\r\n\r\nexport const selectLoginType = createDraftSafeSelector(\r\n  selectSelf,\r\n  (admin) => admin.loginType\r\n);\r\n\r\nexport const selectAccountDetails = createDraftSafeSelector(\r\n  selectSelf,\r\n  (admin) => admin.accountDetails\r\n);","import { createSlice, createAsyncThunk, createDraftSafeSelector } from '@reduxjs/toolkit';\r\nimport { RootState } from 'app/store';\r\nimport { loginWithEmailAndPassword, selectAccountDetails } from 'app/adminSlice'\r\nimport ArticleComponent from 'components/Article/Article';\r\n\r\nimport { App, User, Credentials } from \"realm-web\";\r\n\r\nexport interface Article {\r\n  name: string;\r\n  content: string;\r\n  draftStatus: boolean;\r\n  tags?: string[];\r\n}\r\n\r\nexport interface ArticlesData {\r\n  articles: Article[];\r\n};\r\n\r\nexport type ArticlesDataProperties = {\r\n  articlesData: ArticlesData;\r\n};\r\n\r\nexport const databaseApi: {\r\n  application: App | undefined | null;\r\n  applicationUser: User | undefined | null;\r\n} = {\r\n  application: null,\r\n  applicationUser: null\r\n};\r\n\r\nconst initialState: {\r\n  status: 'idle' | 'loading' | 'succeed' | 'failed';\r\n  articlesData: ArticlesData;\r\n} = {\r\n  status: 'idle',\r\n  articlesData: {\r\n    articles: []\r\n  },\r\n};\r\n\r\n// @ts-ignore\r\nfunction tryToCallWithUser(fn) {\r\n// @ts-ignore\r\n  return async function(argument, thunkApi) {\r\n    try {\r\n      if (databaseApi.applicationUser) {\r\n        return await fn(databaseApi.applicationUser, argument, thunkApi);\r\n      } else {\r\n        throw new Error(\"No user? This is some real bad news\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Call with user error: \", error);\r\n      return thunkApi.rejectWithValue(error.response.data);\r\n    }\r\n  }\r\n}\r\n\r\nexport const initApi = createAsyncThunk(\r\n  'articles/initApi',\r\n  async (appId: string, { getState, dispatch, rejectWithValue }) => {\r\n    const state = getState() as RootState;\r\n    try {\r\n      databaseApi.application = new App({ id: appId });\r\n      const accountDetails = state.admin.accountDetails;\r\n      \r\n      await dispatch(loginWithEmailAndPassword(accountDetails));\r\n      await dispatch(queryForArticles(undefined));\r\n    } catch (error) {\r\n      console.error(\"Failed to login because: \", error);\r\n      return rejectWithValue(error.response.data);\r\n    }\r\n  }\r\n);\r\n\r\nexport const queryForArticles = createAsyncThunk(\r\n  'articles/queryForArticles',\r\n  tryToCallWithUser(\r\n// @ts-ignore\r\n    async function(user: Realm.User, query?: any, thunkApi: any) {\r\n      return await user.functions.getAllArticles();\r\n    }\r\n  )\r\n);\r\n\r\nexport const deleteArticle = createAsyncThunk(\r\n  'articles/deleteArticle',\r\n  tryToCallWithUser(\r\n// @ts-ignore\r\n    async function(user: Realm.User, name: string, {dispatch}) {\r\n      await user.functions.removeArticle(name);\r\n      dispatch(queryForArticles(undefined));\r\n    }\r\n  )\r\n);\r\n\r\nexport const insertArticle = createAsyncThunk(\r\n  'articles/insertArticle',\r\n  tryToCallWithUser(\r\n// @ts-ignore\r\n    async function(user: Realm.User, articleContent: Article, {dispatch}) {\r\n      await user.functions.createOrUpdateArticle(articleContent);\r\n      dispatch(queryForArticles(undefined));\r\n    }\r\n  )\r\n);\r\n\r\nconst articlesSlice = createSlice({\r\n  name: 'api',\r\n  initialState,\r\n  reducers: {},\r\n  extraReducers: (builder) => {\r\n    builder.addCase(\r\n      initApi.pending,\r\n      (state) => {\r\n        state.status = 'loading';\r\n      }\r\n    ).addCase(\r\n      initApi.rejected,\r\n      (state) => {\r\n        state.status = 'failed';\r\n      }\r\n    ).addCase(\r\n      initApi.fulfilled,\r\n      (state) => {\r\n        state.status = 'succeed';\r\n      }\r\n    ).addCase(\r\n      queryForArticles.fulfilled,\r\n      (state, action) => {\r\n        state.articlesData = action.payload;\r\n      }\r\n    );\r\n  }\r\n});\r\n\r\nexport default articlesSlice.reducer;\r\nconst selectSelf = (state: RootState) => state.articles;\r\n\r\nexport const selectStatus = createDraftSafeSelector(\r\n  selectSelf,\r\n  (articles) => articles.status\r\n);\r\n\r\nexport const selectArticlesData = createDraftSafeSelector(\r\n  selectSelf,\r\n  (articles) => articles.articlesData\r\n);","import { configureStore, ThunkAction, Action, combineReducers } from '@reduxjs/toolkit';\r\nimport {\r\n  persistStore, persistReducer,\r\n  FLUSH, REHYDRATE, PAUSE, PERSIST, PURGE, REGISTER\r\n} from 'redux-persist';\r\nimport storage from 'redux-persist/lib/storage';\r\n\r\nimport articlesReducer from 'app/articlesSlice';\r\nimport adminReducer from 'app/adminSlice';\r\n\r\n\r\nconst persistConfig = {\r\n  key: 'root',\r\n  storage,\r\n  whitelist: ['admin']\r\n};\r\n\r\nconst rootReducer = combineReducers({\r\n  articles: articlesReducer,\r\n  admin: adminReducer\r\n});\r\n\r\nconst persistedReducer = persistReducer(persistConfig, rootReducer);\r\n\r\n/*\r\nNOTE(jerry):\r\n\r\nPersist store, will not work unless we store additional information, and I only have enough\r\nknowledge to know how to turn off the persistant store and understand that it is a persistant\r\nstore.\r\n\r\nWe just need to store the currently logged user credentials, and we can go from there. Basically\r\non app reinitialization we need to try to login using the existing credentials.\r\n\r\nSo now we don't really have a true or false anymore...\r\n*/\r\n\r\nexport const store = configureStore({\r\n  reducer: persistedReducer,\r\n  middleware: (getDefaultMiddleware) => getDefaultMiddleware({\r\n    serializableCheck: {\r\n      ignoredActions: [\r\n        FLUSH, REHYDRATE, PAUSE, PERSIST, PURGE, REGISTER,\r\n        'articles/queryForArticles/fulfilled'\r\n      ],\r\n      ignoredPaths: ['articles.articlesData']\r\n    }\r\n  })\r\n});\r\n\r\nexport const persistor = persistStore(store);\r\n\r\n\r\nexport type RootState = ReturnType<typeof store.getState>;\r\nexport type AppDispatch = typeof store.dispatch;\r\nexport type AppThunk<ReturnType = void> = ThunkAction<\r\n  ReturnType,\r\n  RootState,\r\n  unknown,\r\n  Action<string>\r\n>;\r\n","import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux';\r\nimport type { RootState, AppDispatch } from './store';\r\n\r\n// Use throughout your app instead of plain `useDispatch` and `useSelector`\r\nexport const useAppDispatch = () => useDispatch<AppDispatch>();\r\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;\r\n","/*\r\n  Store context sensitive information here\r\n */\r\nexport const Secrets = {\r\n    RECYCLOPEDIA_APPLICATION_ID: \"recyclopedia-api-uuuus\",\r\n    ADMIN_PASSWORD: \"tonyisugly\",\r\n    IMGBB_KEY: \"5eba0537206ecc76b4a505e866868853\"\r\n};\r\n","/*\r\n  Parsable is an interface produced from a string input.\r\n  \r\n  It'll convert a string into a `Parsable` object which removes the\r\n  ability to modify the string, and instead replaces it with reading\r\n  facilities that would be very useful for tokenizing or lexical analysis.\r\n  \r\n  To use just do:\r\n\r\n  object = intoParsable(\"abcdefghijklmnop\");\r\n  \r\n  There's also a few premade parsable functions that aid in building parsers.\r\n*/\r\n\r\nexport function intoParsable(input) {\r\n  // I'm internally using snake_case because I'm comfortable with it\r\n  // but everyone else uses camel case.\r\n  let current_character_index = 0;\r\n\r\n  function still_parsing() {\r\n    return (current_character_index < input.length);\r\n  }\r\n\r\n  function peek_character(look_ahead_offset = 0) {\r\n    if (current_character_index + look_ahead_offset > input.length) {\r\n      return null;\r\n    } else {\r\n      return input[current_character_index + look_ahead_offset];\r\n    }\r\n  }\r\n\r\n\r\n  function require_character(character) {\r\n    if (peek_character() === character) {\r\n      eat_character();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function eat_character() {\r\n    if (current_character_index > input.length) {\r\n      return null;\r\n    } else {\r\n      const result = peek_character();\r\n      current_character_index++;\r\n      return result;\r\n    }\r\n  }\r\n\r\n  function consume_until(ending_predicate_fn) {\r\n    let result = \"\";\r\n\r\n    while (still_parsing()) {\r\n      if (ending_predicate_fn()) {\r\n        break;\r\n      } else {\r\n        result += eat_character();\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  function with_preserved_position(progn_fn) {\r\n    const restoration_index = current_character_index;\r\n    let result = progn_fn();\r\n    current_character_index = restoration_index;\r\n    return result;\r\n  }\r\n\r\n  return {\r\n    withPreservedPosition: with_preserved_position,\r\n    stillParsing: still_parsing,\r\n    peekCharacter: peek_character,\r\n    requireCharacter: require_character,\r\n    eatCharacter: eat_character,\r\n    consumeUntil: consume_until,\r\n  };\r\n}\r\n\r\n// TODO(jerry): add escaped characters!\r\nexport function tryParseString(parsable, { delimiter, acceptMultiline }) {\r\n  if (parsable.requireCharacter(delimiter)) {\r\n    let successful_parse = true;\r\n    let string_contents = parsable.consumeUntil(\r\n      function () {\r\n        if (!acceptMultiline && parsable.requireCharacter('\\n')) {\r\n          successful_parse = false;\r\n          return true;\r\n        } else if (parsable.requireCharacter(delimiter)) {\r\n          return true;\r\n        }\r\n        return false;\r\n      }\r\n    );\r\n    if (string_contents && successful_parse) {\r\n      return string_contents;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n// Pairs are singular characters unfortunately.\r\n// not strings.\r\nexport function matchedQuotePairs(parsable) {\r\n  return true;\r\n\r\n  // Henry: Commented out to resolve warnings in console\r\n\r\n  // return parsable.withPreservedPosition(\r\n  //   function () {\r\n  //     let count = 0;\r\n\r\n  //     while (parsable.stillParsing()) {\r\n  //       if (parsable.requireCharacter('\\\\')) {\r\n  //         parsable.eatCharacter();\r\n  //       } else {\r\n  //         if (parsable.requireCharacter('\\'')) {\r\n  //           count++;\r\n  //         }\r\n  //         parsable.eatCharacter();\r\n  //       }\r\n  //     }\r\n\r\n  //     return (count % 2 === 0);\r\n  //   }\r\n  // );\r\n}\r\n\r\n// console.log(tryParseString(intoParsable('\\'Hello\\nWorld!\\'|'), {delimiter: '\\'', acceptMultiline: true}));\r\n// console.log(tryParseString(intoParsable('\\'Hello\\nWorld!\\'|'), {delimiter: '\\''}));\r\n\r\nconst is_literal_acceptable = (c) => (c >= 'a' && c <= 'z') || (c >= 'A' && c <= 'Z') || (c >= '0' && c <= '9');\r\nexport function eatIdentifier(parsable) {\r\n  if (parsable.stillParsing()) {\r\n    return parsable.consumeUntil(() => !is_literal_acceptable(parsable.peekCharacter()));\r\n  } else {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function eatWhitespace(parsable) {\r\n  while (parsable.stillParsing()) {\r\n    if (parsable.peekCharacter() === ' ') {\r\n      parsable.eatCharacter();\r\n    } else {\r\n      console.log(parsable.peekCharacter());\r\n      break;\r\n    }\r\n  }\r\n}\r\n","/*\r\n  This is the markdown preprocessor for any special extensions we might want to support.\r\n  \r\n  Does not really do tokenizing, so be ware of dragons.\r\n */\r\nimport { intoParsable, tryParseString, eatIdentifier, eatWhitespace } from 'utils/intoParsable';\r\n\r\ninterface HeaderInformation {\r\n  level: number,\r\n  text: string\r\n}\r\nexport interface MarkdownParsedMetaInformation {\r\n  processed: string,\r\n  imageLinks: string[],\r\n  headers: HeaderInformation[],\r\n}\r\n\r\nexport function preprocessMarkdown(stringInput: string): MarkdownParsedMetaInformation {\r\n  let result = \"\";\r\n  const input = intoParsable(stringInput);\r\n\r\n  let actualResult = {\r\n    processed: \"\",\r\n    imageLinks: [],\r\n    headers: []\r\n  };\r\n\r\n  while (input.stillParsing()) {\r\n    if (input.requireCharacter('\\\\')) {\r\n      const nextCharacter = input.eatCharacter();\r\n      if (nextCharacter === '\\n') {\r\n        result += \"<br/>\\n\";\r\n      } else {\r\n        result += nextCharacter;\r\n      }\r\n    } else if (input.requireCharacter('@')) {\r\n      if (input.requireCharacter('@')) {\r\n        let has_end = false;\r\n        /*\r\n          Whenever our region fails to parse it'll just refuse to output anything.\r\n          \r\n          @ asdf @ asdf -> @ asdf @ asdf\r\n          @@ asdf @ asdf -> null\r\n          @@ asdf @@ asdf -> whatever we would've parsed.\r\n          \r\n          if you need multiple @ signs consecutively just do\r\n          \\@\\@ or @\\@.\r\n         */\r\n        let inbetween = intoParsable(\r\n          input.consumeUntil(\r\n            function () {\r\n              if (input.requireCharacter('\\n')) {\r\n                return true;\r\n              } else if (input.requireCharacter('@')) {\r\n                /*\r\n                  When we encounter an @ sign, it's likely to be the end of parsing a \"region\".\r\n                 */\r\n                if (input.requireCharacter('@')) {\r\n                  has_end = true;\r\n                }\r\n                return true;\r\n              }\r\n              return false;\r\n            }\r\n          )\r\n        );\r\n\r\n        if (inbetween && has_end) {\r\n          let image_tag = \"<img \";\r\n          let error = false;\r\n\r\n          while (inbetween.stillParsing() && !error) {\r\n            eatWhitespace(inbetween);\r\n            let property = eatIdentifier(inbetween);\r\n            if (property) {\r\n              image_tag += property;\r\n              eatWhitespace(inbetween);\r\n              if (inbetween.requireCharacter('=')) {\r\n                image_tag += \"=\";\r\n                eatWhitespace(inbetween);\r\n                if (inbetween.peekCharacter() === '\\'') {\r\n                  // @ts-ignore\r\n                  let maybe_string = tryParseString(inbetween, { delimiter: '\\'' });\r\n                  if (maybe_string) {\r\n                    image_tag += '\\'' + maybe_string + '\\'';\r\n                    if (property === \"src\") {\r\n                      // @ts-ignore\r\n                      actualResult.imageLinks.push(maybe_string);\r\n                    }\r\n                  } else {\r\n                    console.error(\"No string value?\");\r\n                    error = true;\r\n                  }\r\n                } else {\r\n                  let value_identifier = eatIdentifier(inbetween);\r\n                  if (value_identifier) {\r\n                    image_tag += value_identifier;\r\n                  } else {\r\n                    console.error(\"No value identifier?\");\r\n                    error = true;\r\n                  }\r\n                }\r\n                eatWhitespace(inbetween);\r\n                if (!inbetween.requireCharacter('|')) {\r\n                  // @ts-ignore\r\n                  if (eatIdentifier(inbetween) || tryParseString(inbetween, { delimiter: '\\'' })) {\r\n                    console.error(\"Missing pipe separator!\");\r\n                    error = true;\r\n                  }\r\n                }\r\n              } else {\r\n                console.error(\"Missing assignment for property?\");\r\n                error = true;\r\n              }\r\n            } else {\r\n              console.error(\"Could not find property name!\");\r\n              error = true;\r\n            }\r\n            image_tag += \" \";\r\n          }\r\n          image_tag += \"/>\";\r\n          if (!error) {\r\n            result += image_tag;\r\n          } else {\r\n            console.log(\"error happened\");\r\n          }\r\n        } else {\r\n          // not valid tag. Don't do anything.\r\n          // maybe add a newline since there should really only be one image per\r\n          // line as per markup style.\r\n          result += '\\n';\r\n        }\r\n      } else {\r\n        result += '@';\r\n      }\r\n    } else {\r\n      if (input.peekCharacter() === '#') {\r\n        let headerCount = input.consumeUntil(() => {\r\n            result += input.peekCharacter();\r\n            return (input.peekCharacter() !== '#');\r\n        }).length;\r\n\r\n        let textContents = input.consumeUntil(() => {\r\n          result += input.peekCharacter();\r\n          return input.peekCharacter() === '\\n';\r\n        });\r\n\r\n        actualResult.headers.push({\r\n        // @ts-ignore\r\n          level: headerCount,\r\n        // @ts-ignore\r\n          text: textContents\r\n        });\r\n      }\r\n      result += input.eatCharacter();\r\n    }\r\n  }\r\n\r\n  actualResult.processed = result;\r\n  return actualResult as MarkdownParsedMetaInformation;\r\n}","import MD from 'markdown-it';\r\nconst md = MD({\r\n  html: true,\r\n  breaks: true,\r\n  linkify: true,\r\n  typographer: true,\r\n});\r\n\r\nexport const renderMarkdown = (text: string) => md.render(text);\r\n\r\nfunction MarkdownRender({\r\n  className, children\r\n}: {\r\n  className: string; children: string;\r\n}) {\r\n  return (<div\r\n    className={className}\r\n    dangerouslySetInnerHTML={{ __html: renderMarkdown(children) }}>\r\n  </div>);\r\n}\r\n\r\nexport default MarkdownRender;","import noticeBannerStyles from './NoticeBanner.module.scss';\r\nimport { useState } from 'react';\r\n\r\nexport function NoticeBanner({\r\n  children, dirtyFlag\r\n}: {\r\n  children: React.ReactNode;\r\n  dirtyFlag: boolean;\r\n}) {\r\n  const styles = [noticeBannerStyles.dropOut, noticeBannerStyles.dropIn];\r\n\r\n  const [selfDirtyFlag, updateSelfDirtyFlag] = useState(dirtyFlag);\r\n  const [style, updateStyle] = useState(0);\r\n\r\n  if (dirtyFlag !== selfDirtyFlag) {\r\n    updateStyle((style + 1));\r\n    updateSelfDirtyFlag(!selfDirtyFlag);\r\n  }\r\n\r\n  return (\r\n    <div className={noticeBannerStyles.main + \" \" + styles[style % 2]}>\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useEffect, useRef } from 'react';\r\nimport { Secrets } from \"secrets\";\r\n\r\n//Return the current property of a ref if it is a ref\r\nexport const getRefCurrent = (ref: React.MutableRefObject<any>) => {\r\n  return ref.hasOwnProperty(\"current\")\r\n    ? ref.current\r\n    : ref;\r\n};\r\n\r\nexport const validPageLink = (originalName: string) => `/${originalName.toLowerCase().trim().replace(/ +/g, '_')}`;\r\n\r\nexport async function uploadImage(image_name: string) {\r\n  const form_data = new FormData();\r\n  form_data.append(\"image\", image_name);\r\n\r\n  const expirationValue = 600;\r\n  const requestUrl = `https://api.imgbb.com/1/upload?expiration${expirationValue}&key=${Secrets.IMGBB_KEY}`;\r\n  console.log(requestUrl);\r\n  const res = await fetch(requestUrl, { method: \"POST\", body: form_data, });\r\n  console.log(\"waiting...\");\r\n\r\n  return await res.json();\r\n}\r\n\r\n// for now this is an alias.\r\ntype Base64String = string;\r\ntype RetrievedImageCallback = (f: Base64String) => void;\r\nexport async function retrieveImageData(\r\n    imageFile: File,\r\n    whenRetrieved: RetrievedImageCallback\r\n  ) {\r\n  const image_file = imageFile;\r\n  const img = document.createElement('img');\r\n  img.src = URL.createObjectURL(image_file);\r\n  console.log(\"attempting to load: \", image_file);\r\n  img.onload = async function () {\r\n    const canvas = document.createElement(\"canvas\");\r\n    const canvas_context = canvas.getContext(\"2d\");\r\n    if (canvas_context) {\r\n      canvas.width = img.width;\r\n      canvas.height = img.height;\r\n\r\n      canvas_context.drawImage(img, 0, 0);\r\n      const imgData = canvas.toDataURL().split(',')[1];\r\n      console.log(\"image data retrieved\");\r\n      whenRetrieved(imgData);\r\n    } else {\r\n      console.log(\"null canvas?\");\r\n    }\r\n  };\r\n}\r\n\r\n/*\r\n  These functions are legitimately supposed to be any. These are supposed to operate indiscriminately\r\n  on any type of dictionary like object.\r\n\r\n  Javascript allows you to use anything as a key technically for dictionaries,\r\n  but this is as close I can get to that I suppose...\r\n */\r\n\r\nexport function dictionaryUpdateKey(\r\n  dictionary: {[key: string]: any}, \r\n  key: any,\r\n  updateFunction: (f: unknown) => unknown\r\n) {\r\n  const newDictionary = { ...dictionary };\r\n  newDictionary[key] = updateFunction(dictionary[key]);\r\n  return newDictionary;\r\n}\r\n\r\nexport function dictionaryUpdateKeyNested(\r\n  dictionary: {[key: string]: any}, \r\n  keys: any[],\r\n  updateFunction: (f: unknown) => unknown\r\n) {\r\n  if (keys.length > 1) {\r\n    const shallowClone = { ...dictionary };\r\n    shallowClone[keys[0]] =\r\n      dictionaryUpdateKeyNested(shallowClone[keys[0]], keys.slice(1), updateFunction);\r\n    return shallowClone;\r\n  }\r\n\r\n  // returns\r\n  return dictionaryUpdateKey(dictionary, keys[0], updateFunction);\r\n}\r\n\r\nexport const useTimeout = (callback: (f: void) => void, delay: number) => {\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => callback(), delay);\r\n    return () => clearTimeout(timer);\r\n  }, [delay, callback]);\r\n};\r\n\r\nexport function randomElt(array: any[]) {\r\n  return array[Math.floor(Math.random() * array.length)];\r\n}\r\n","/*\r\n    Inhouse DOM to Markdown interpreter.\r\n*/\r\nfunction log_message(msg) {}\r\nfunction surrounder(sym) {\r\n  return function (content) {\r\n    let spacesLeft = 0;\r\n    let spacesRight = 0;\r\n    for (let i = 0; i < content.length; ++i) {\r\n      if (content[i] !== ' ') {\r\n        spacesLeft = i - 1;\r\n        break;\r\n      }\r\n    }\r\n    for (let i = content.length - 1; i > 0; --i) {\r\n      if (content[i] !== ' ') {\r\n        break;\r\n      }\r\n      spacesRight++;\r\n    }\r\n    return `${spacesLeft > 0 ? \" \".repeat(spacesLeft) : \"\"}${sym}${content.trim()}${sym}${spacesRight > 0 ? \" \".repeat(spacesRight) : \"\"}`;\r\n  };\r\n}\r\nconst surrounders = {\r\n  \"B\": surrounder(\"**\"),\r\n  \"STRONG\": surrounder(\"**\"),\r\n  \"I\": surrounder(\"_\"),\r\n  \"EM\": surrounder(\"_\"),\r\n  \"U\": surrounder(\"__\"),\r\n};\r\nconst safe_call = (fn, ...rest) => (...rest) => (fn) ? fn(...rest) : rest[0];\r\n/*\r\nNOTE(jerry):\r\n\r\nI'm not a particular fan of this since this is definitely very scrappy. It does not know how to\r\nproperly handle nested lists, although without extra modification the RichTextEditor doesn't allow you\r\nto do nested lists trivially anyways... So hopefully it's not much of a disaster (just store the current indent\r\nlevel and then do it based off of whatever markdown seems to recognize a list as.)\r\n\r\nMost other normal elements are handled fine, it's really just the lists I'm concerned about.\r\n\r\nThis is entirely recursive, and because it's recursive it loses some information that may be useful for\r\ncleaner and probably easier rendering...\r\n*/\r\nfunction renderElement(root, text_contents) {\r\n  if (text_contents !== \"\") {\r\n    if (root.tagName === \"P\") {\r\n      log_message(\"paragraph\");\r\n      log_message(root.parentElement);\r\n      if (root.parentElement && (root.parentElement.tagName === \"LI\")) {\r\n        log_message(\"Parent was list?\");\r\n        return text_contents;\r\n      } else {\r\n        return text_contents + \"\\n\\n\";\r\n      }\r\n    } else if (root.tagName[0] === 'H') {\r\n      return \"#\".repeat(Number(root.tagName[1])) + \" \" + text_contents + \"\\n\";\r\n    } else if (root.tagName === \"OL\") {\r\n      let i = 0;\r\n      return Array.from(root.children).reduce(\r\n        function (accumulator, listItem) {\r\n          const childText = renderDomAsMarkdown(listItem);\r\n          if (childText !== \"\") {\r\n            return accumulator + `${((i++) + 1)}. ${childText}\\n`;\r\n          } else {\r\n            return accumulator;\r\n          }\r\n        }, \"\");\r\n    } else if (root.tagName === \"UL\") {\r\n      return Array.from(root.children).reduce(\r\n        function (accumulator, listItem) {\r\n          const childText = renderDomAsMarkdown(listItem);\r\n          if (childText !== \"\") {\r\n            return accumulator + `- ${childText}\\n`;\r\n          } else {\r\n            return \"\";\r\n          }\r\n        }, \"\");\r\n    }\r\n\r\n    log_message(\"going to try and root out tags friends\", root.tagName);\r\n    return safe_call(surrounders[root.tagName])(text_contents);\r\n  } else {\r\n    if (root.tagName === \"IMG\") {\r\n      const src = root.getAttribute(\"src\");\r\n      const result = `@@ src = '${src}' @@\\n`;\r\n      return result;\r\n    }\r\n\r\n    return (root.tagName === \"P\" || root.tagName === \"BR\") ? \"\\\\\\n\" : \"\";\r\n  }\r\n}\r\n\r\nexport function renderDomAsMarkdown(root) {\r\n  if (root.nodeType === 3) {\r\n    return root.textContent;\r\n  } else if (root.hasChildNodes()) {\r\n    const childrenStrings = Array.from(root.childNodes).reduce((output, node) => { return output + renderDomAsMarkdown(node); }, \"\");\r\n    const res = renderElement(root, childrenStrings);\r\n    return res;\r\n  } else {\r\n    return renderElement(root, \"\");\r\n  }\r\n\r\n  return \"\";\r\n}\r\n","import React from 'react';\r\n\r\nimport { dictionaryUpdateKey, dictionaryUpdateKeyNested } from 'utils/functions';\r\n\r\nexport type WidgetCategoryDic = Record<string,WidgetCategory>;\r\nexport type WidgetInformationDic = Record<string, WidgetInformation>;\r\n\r\nexport interface WidgetInformation {\r\n  name: string,\r\n  display?: JSX.Element,\r\n  command: string,\r\n  argument?: string,\r\n  category?: string,\r\n};\r\n\r\nexport interface WidgetCategory {\r\n  active: string | null,\r\n  types: WidgetInformationDic\r\n};\r\n\r\nexport const widgets: WidgetCategoryDic = {\r\n  heading: {\r\n    active: null,\r\n    types: {\r\n      h1: { name: \"Heading 1\", display: <b>h1</b>, command: \"heading\", argument: \"H1\", category: \"heading\" },\r\n      h2: { name: \"Heading 2\", display: <b>h2</b>, command: \"heading\", argument: \"H2\", category: \"heading\" },\r\n      h3: { name: \"Heading 3\", display: <b>h3</b>, command: \"heading\", argument: \"H3\", category: \"heading\" },\r\n      h4: { name: \"Heading 4\", display: <b>h4</b>, command: \"heading\", argument: \"H4\", category: \"heading\" },\r\n      h5: { name: \"Heading 5\", display: <b>h5</b>, command: \"heading\", argument: \"H5\", category: \"heading\" },\r\n      h6: { name: \"Heading 6\", display: <b>h6</b>, command: \"heading\", argument: \"H6\", category: \"heading\" },\r\n    }\r\n  },\r\n  image: {\r\n    active: null,\r\n    types: {\r\n      image: { name: \"Image\", display: <b>Insert Image</b>, command: \"@_insertImage\", category: \"image\" },\r\n    }\r\n  },\r\n  list: {\r\n    active: null,\r\n    types: {\r\n      orderedList: { name: \"Ordered List\", command: \"insertorderedlist\", category: \"list\" },\r\n      unorderedList: { name: \"Unordered List\", command: \"insertunorderedlist\", category: \"list\" },\r\n    }\r\n  },\r\n  // disadvantage at the moment. You don't have to do this, but this makes the current format work without code changes\r\n  bold: {\r\n    active: null,\r\n    types: {\r\n      bold: { name: \"Bold\", display: <b>B</b>, command: \"bold\" }\r\n    }\r\n  },\r\n  italic: {\r\n    active: null,\r\n    types: {\r\n      italic: { name: \"Italic\", display: <em>I</em>, command: \"italic\" }\r\n    }\r\n  },\r\n  underline: {\r\n    active: null,\r\n    types: {\r\n      underline: { name: \"Underline\", display: <u>UL</u>, command: \"underline\" }\r\n    }\r\n  },\r\n};\r\n\r\nexport function toggleWidgetActiveState(widgets: WidgetCategoryDic, widgetId: string, categoryValue?: string) {\r\n  return dictionaryUpdateKeyNested(\r\n    widgets,\r\n    [(categoryValue) ? (categoryValue) : (widgetId), \"active\"],\r\n    (currentlyActive) => (currentlyActive === widgetId) ? null : widgetId\r\n  );\r\n}\r\n\r\nexport function flattenWidgetStateTypes(widgets: WidgetCategoryDic): WidgetInformationDic {\r\n  return Object.entries(widgets).reduce(\r\n    function (accumulator, [id, { types }]) {\r\n      return Object.entries(types).reduce(\r\n        function (accumulator, [key, value]) {\r\n          const copy = { ...accumulator as WidgetInformationDic };\r\n          copy[key] = value;\r\n          return copy;\r\n        },\r\n        accumulator\r\n      );\r\n    }\r\n    , {});\r\n}\r\n","import styles from 'components/Form/Button.module.scss';\r\n\r\nconst Button = ({\r\n  children = '',\r\n  type = 'button',\r\n  styleOption,\r\n  ...props\r\n}: {\r\n  children?: React.ReactNode;\r\n  type?: 'submit' | 'reset' | 'button';\r\n  styleOption?: string;\r\n  onClick?(): void;\r\n}) => {\r\n  return (\r\n    <button\r\n      className={`${styles.button} ${styleOption ? styles[styleOption] : ''}`}\r\n      type={type}\r\n      {...props}\r\n    >\r\n      {children}\r\n    </button>\r\n  );\r\n};\r\n\r\nexport default Button;\r\n","import { useState, useRef, KeyboardEventHandler, } from 'react';\r\nimport { preprocessMarkdown } from 'utils/preprocessMarkdown';\r\nimport { uploadImage, retrieveImageData } from 'utils/functions';\r\n\r\nimport { renderMarkdown } from \"components/Article/MarkdownRender\";\r\nimport { renderDomAsMarkdown } from 'utils/DOMIntoMarkdown';\r\nimport { dictionaryUpdateKeyNested } from 'utils/functions';\r\nimport { widgets, toggleWidgetActiveState, flattenWidgetStateTypes, WidgetCategory } from './RichTextEditWidgetInformation';\r\n\r\nimport { Article } from 'app/articlesSlice';\r\n\r\nimport bottomToolbarStyle from './bottomToolbar.module.scss';\r\nimport richWidgetBarStyle from './richWidgetBar.module.scss';\r\nimport styles from 'pages/Admin/Admin.module.scss';\r\nimport articleStyles from 'components/Article/Article.module.scss';\r\nimport Button from 'components/Form/Button';\r\n\r\nfunction executeRichTextCommand(commandName: string, optionalArgument?: string) {\r\n  if (commandName === \"@_insertImage\") {\r\n    console.log(\"image handling\");\r\n    const fileDialog = document.createElement(\"input\");\r\n    fileDialog.type = \"file\";\r\n    fileDialog.click();\r\n\r\n    // TODO(jerry): cleanup\r\n    fileDialog.addEventListener(\"change\", fileHandlerOnChange);\r\n  } else {\r\n    document.execCommand(commandName, false, optionalArgument);\r\n  }\r\n}\r\n\r\nfunction queryRichTextCommand(command: string, wantedValue?: boolean) {\r\n  if (wantedValue) {\r\n    return document.queryCommandValue(command);\r\n  } else {\r\n    return document.queryCommandState(command);\r\n  }\r\n}\r\n\r\nfunction fileHandlerOnChange({ target }: Event): void {\r\n  const probablyFile = (target as HTMLInputElement).files?.[0];\r\n\r\n  if (probablyFile)\r\n    retrieveImageData(probablyFile,\r\n      function (imgData) {\r\n        uploadImage(imgData).then(\r\n          function (imgURL) {\r\n            if (imgURL.success) {\r\n              document.execCommand(\"insertImage\", false, imgURL.data.url);\r\n            } else {\r\n              console.error(\"IMGBB is down. Tony pls get us a server\");\r\n            }\r\n          }\r\n        );\r\n      });\r\n}\r\n\r\nfunction editorHandleKeybindings({\r\n  saveDocument,\r\n  toggleWidget,\r\n  executeRichTextCommand,\r\n  updateDirtyFlag\r\n}: {\r\n  saveDocument: () => void,\r\n  toggleWidget: (widgetId: string, categoryValue?: string) => void,\r\n  executeRichTextCommand: (command: string, argument?: string) => void,\r\n  updateDirtyFlag: React.Dispatch<boolean>,\r\n}): KeyboardEventHandler<HTMLDivElement> {\r\n  return function (event) {\r\n    const { key, shiftKey, ctrlKey } = event;\r\n    let disableDefaultBehavior = false;\r\n    if (ctrlKey) {\r\n      if (!shiftKey) {\r\n        switch (key) {\r\n          case 's':\r\n            saveDocument();\r\n            disableDefaultBehavior = true;\r\n            break;\r\n          case 'b':\r\n            toggleWidget(\"bold\");\r\n            executeRichTextCommand(\"bold\");\r\n            disableDefaultBehavior = true;\r\n            break;\r\n          case 'i':\r\n            toggleWidget(\"italic\");\r\n            executeRichTextCommand(\"italic\");\r\n            disableDefaultBehavior = true;\r\n            break;\r\n          case 'u':\r\n            toggleWidget(\"underline\");\r\n            executeRichTextCommand(\"underline\");\r\n            disableDefaultBehavior = true;\r\n            break;\r\n          case '1': case '2': case '3': case '4': case '5': case '6':\r\n            toggleWidget(`h${key}`, \"heading\");\r\n            executeRichTextCommand(\"heading\", `H${key}`);\r\n            disableDefaultBehavior = true;\r\n            break;\r\n        }\r\n      } else {\r\n        console.log(\"CTRL and SHIFT\", key);\r\n        switch (key) {\r\n          case 'U':\r\n            console.log(\"unordered list\");\r\n            executeRichTextCommand(\"insertunorderedlist\");\r\n            disableDefaultBehavior = true;\r\n            break;\r\n          case 'O':\r\n            executeRichTextCommand(\"insertorderedlist\");\r\n            disableDefaultBehavior = true;\r\n            break;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (disableDefaultBehavior) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n    } else {\r\n      updateDirtyFlag(true);\r\n    }\r\n  };\r\n}\r\n\r\nconst editModeInlineStyle = {\r\n  borderColor: \"black\",\r\n  borderWidth: \"1px\",\r\n  margin: \"0.3em\",\r\n  borderStyle: \"solid\",\r\n};\r\n\r\nexport function RichTextEditor({\r\n  submissionHandler,\r\n  currentArticle,\r\n  updateDirtyFlag,\r\n  toggleDraftStatus\r\n}:\r\n  {\r\n    submissionHandler: (f: { name: string, content: string; }) => void,\r\n    currentArticle?: Article,\r\n    updateDirtyFlag: React.Dispatch<React.SetStateAction<boolean>>,\r\n    toggleDraftStatus: () => void,\r\n  }) {\r\n  const [initialArticleState, _] = useState(currentArticle);\r\n  const editableTitleDOMRef = useRef<HTMLHeadingElement>(null);\r\n  const editableAreaDOMRef = useRef<HTMLDivElement>(null);\r\n\r\n  document.execCommand(\"defaultParagraphSeparator\", false, \"br\");\r\n  const [widgetStates, updateWidgetState] = useState(widgets);\r\n\r\n  function saveDocument() {\r\n    if (editableAreaDOMRef.current && editableTitleDOMRef.current) {\r\n      const markdownText = renderDomAsMarkdown(editableAreaDOMRef.current);\r\n      submissionHandler({\r\n        name: (initialArticleState?.name) || (editableTitleDOMRef.current.textContent || \"\"),\r\n        content: markdownText\r\n      });\r\n\r\n      if (initialArticleState === undefined) {\r\n        editableAreaDOMRef.current.innerHTML = renderMarkdown(preprocessMarkdown(markdownText).processed);\r\n      }\r\n    }\r\n  }\r\n\r\n  // would only apply to a few relevant states.\r\n  function _toggleWidgetActiveState(widgetId: string, categoryValue?: string) {\r\n    updateWidgetState(toggleWidgetActiveState(widgetStates, widgetId, categoryValue));\r\n  }\r\n\r\n  function synchronizeCommandStateToWidgetBar() {\r\n    updateWidgetState(\r\n      Object.keys(widgetStates).reduce(\r\n        (newWidgetState, type) => {\r\n          return dictionaryUpdateKeyNested(newWidgetState, [type, \"active\"],\r\n            (type === \"heading\") ?\r\n              () => queryRichTextCommand(type, true) :\r\n              () => queryRichTextCommand(type) ? type : null\r\n          );\r\n        }, widgetStates)\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className={richWidgetBarStyle.main}> {/*requires styling*/}\r\n        {\r\n          Object.entries(flattenWidgetStateTypes(widgetStates)).map(\r\n            ([widgetId, widget]) =>\r\n              <button\r\n                key={widgetId}\r\n                id={widgetId}\r\n                className={\r\n                  ((widgetStates[(widget.category !== undefined) ?\r\n                    widget.category : widgetId].active) === widgetId) ?\r\n                    richWidgetBarStyle.active : richWidgetBarStyle.button\r\n                }\r\n                onClick={\r\n                  (_) => {\r\n                    _toggleWidgetActiveState(widgetId, widget.category);\r\n                    executeRichTextCommand(widget.command, widget.argument);\r\n                  }\r\n                }>{(widget.display) ? widget.display : widget.name}\r\n              </button>\r\n          )\r\n        }\r\n      </div>\r\n      <h1\r\n        className={styles.title}\r\n        contentEditable={(initialArticleState) ? \"false\" : \"true\"}\r\n        ref={editableTitleDOMRef}\r\n      >\r\n        {(currentArticle) ? currentArticle.name : \"Edit New Title\"}\r\n      </h1>\r\n      <div style={editModeInlineStyle}>\r\n        <div\r\n          contentEditable={true}\r\n          className={articleStyles.article}\r\n          onSelect={synchronizeCommandStateToWidgetBar}\r\n          onKeyDown={editorHandleKeybindings({\r\n            saveDocument: saveDocument,\r\n            toggleWidget: _toggleWidgetActiveState,\r\n            executeRichTextCommand: executeRichTextCommand,\r\n            updateDirtyFlag: updateDirtyFlag,\r\n          })}\r\n          dangerouslySetInnerHTML={\r\n            { __html: renderMarkdown(preprocessMarkdown((initialArticleState) ? initialArticleState.content : \"Begin typing your article.\").processed) }\r\n          }\r\n          ref={editableAreaDOMRef}>\r\n        </div>\r\n      </div>\r\n      <br></br>\r\n      <br></br>\r\n      <div className={bottomToolbarStyle.main}>\r\n        <Button onClick={() => { toggleDraftStatus(); }}>\r\n          Toggle Draft Status\r\n        </Button>\r\n        <Button onClick={saveDocument}>\r\n          {(initialArticleState)\r\n            ? \"Save Article\"\r\n            : \"Submit Article\"}\r\n        </Button>\r\n      </div>\r\n    </>\r\n  );\r\n}","import { useState } from 'react';\r\n\r\nimport { useAppDispatch } from 'app/hooks';\r\nimport { insertArticle, Article } from 'app/articlesSlice';\r\n\r\nimport { NoticeBanner } from './Editors/NoticeBanner';\r\nimport { RichTextEditor } from \"./Editors/RichTextEditor\";\r\nimport { TagEditor } from 'pages/Admin/TagEditor';\r\n\r\nexport default function Admin({\r\n  currentArticle\r\n}: {\r\n  currentArticle?: Article;\r\n}) {\r\n  const dispatch = useAppDispatch();\r\n  const [dirtyFlag, updateDirtyFlag] = useState(false);\r\n\r\n  const [draftStatus, updateDraftStatus] = useState((currentArticle?.draftStatus));\r\n\r\n  function submitHandler(input: Article, onFinishedCallback?: (input: Article) => void) {\r\n    dispatch(insertArticle(input));\r\n    onFinishedCallback?.(input);\r\n  };\r\n\r\n  const submissionHandler = (\r\n    submissionData: {\r\n      name: string;\r\n      content: string;\r\n    }\r\n  ) => {\r\n    submitHandler(\r\n      { ...submissionData, draftStatus: !!draftStatus },\r\n      ({ name }) => {\r\n        console.log(`Article ${name} written!`);\r\n        updateDirtyFlag(false);\r\n      }\r\n    );\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <h2>{(draftStatus) ? \"DRAFT*\" : \"WILL PUBLISH ON SAVE\"}</h2>\r\n      <NoticeBanner dirtyFlag={dirtyFlag}>You have unsaved changes!</NoticeBanner>\r\n      <RichTextEditor\r\n        submissionHandler={submissionHandler}\r\n        currentArticle={currentArticle}\r\n        updateDirtyFlag={updateDirtyFlag}\r\n        toggleDraftStatus={() => updateDraftStatus(!draftStatus)}\r\n      />\r\n\r\n      {/* <TagEditor currentArticle={currentArticle}/> */}\r\n    </>\r\n  );\r\n}","import styles from 'components/Article/Article.module.scss';\r\nimport { useState } from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\n\r\nimport { useAppSelector, useAppDispatch } from 'app/hooks';\r\nimport { deleteArticle, Article } from 'app/articlesSlice';\r\nimport { LoginType, selectLoginType } from 'app/adminSlice';\r\n\r\nimport { preprocessMarkdown } from 'utils/preprocessMarkdown';\r\n\r\nimport MarkdownRender from \"components/Article/MarkdownRender\";\r\nimport Admin from 'pages/Admin/Admin';\r\n\r\n// @ts-ignore\r\nfunction TableOfContents({sectionHeaders} : {sectionHeaders: any[]}) {\r\n  return (sectionHeaders.length > 0) ? (<div style={\r\n    {\r\n      border: \"1px dotted black\",\r\n      margin: \"2em\",\r\n      padding: \"1.5em\"\r\n    }\r\n  }>\r\n    <h3>Table Of Contents</h3>\r\n    <div style={\r\n      {\r\n        marginLeft: \"3em\",\r\n      }\r\n    }>\r\n      {\r\n        sectionHeaders.map(\r\n          ({ level, text }) => {\r\n            /*\r\n              Technically I should be making this a list, but it's kind of\r\n              PITA to do it as it requires me to nest them in a specific way, that would\r\n              make me special case the header parsing generation.\r\n\r\n              This may look wrong on screen-readers or something. Sorry.\r\n            */\r\n            return (\r\n              <a href={\"#todo\"}>\r\n                <p style=\r\n                  {\r\n                    {\r\n                      marginLeft: `${(level - 1) * 2}em`\r\n                    }\r\n                  }>&bull; {text}\r\n                </p>\r\n              </a>\r\n            )\r\n          }\r\n        )\r\n      }\r\n    </div>\r\n  </div>\r\n  ) : null;\r\n}\r\n\r\nfunction ArticleComponent({\r\n  article\r\n}: {\r\n  article: Article;\r\n}) {\r\n  const history = useHistory();\r\n  const dispatch = useAppDispatch();\r\n  const currentLoginType = useAppSelector(selectLoginType);\r\n  const isAdmin = currentLoginType === LoginType.Admin;\r\n\r\n  const { name, content } = article;\r\n  const [adminEditView, updateAdminEditView] = useState(false);\r\n\r\n  const processedMarkdown = preprocessMarkdown(content);\r\n  return (\r\n    <>\r\n      {\r\n        isAdmin && (\r\n          <>\r\n            <button\r\n              onClick={() => {\r\n                dispatch(deleteArticle(name));\r\n                history.push('/');\r\n              }}\r\n            >\r\n              Delete Page\r\n            </button>\r\n            <button\r\n              onClick={() => updateAdminEditView(!adminEditView)}\r\n            >\r\n              Edit This Page\r\n            </button>\r\n          </>\r\n        )\r\n      }\r\n      {(\r\n        isAdmin && adminEditView\r\n      ) ? (\r\n        <Admin\r\n          currentArticle={article}\r\n        />\r\n      ) : (\r\n        <>\r\n          <h1 className={styles.title}> {name} </h1>\r\n          <TableOfContents sectionHeaders={processedMarkdown.headers}/>\r\n          <MarkdownRender className={styles.article}>\r\n           {processedMarkdown.processed} \r\n          </MarkdownRender>\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default ArticleComponent;","export default function approximateSearch(entries, key) {\r\n  let copy = [...entries].sort();\r\n\r\n  // case insensitive\r\n  function matched_characters(a, b) {\r\n    if (a !== undefined && b !== undefined) {\r\n      let count = 0;\r\n      let shorter_length = Math.min(a.length, b.length);\r\n\r\n      for (let i = 0; i < shorter_length; ++i) {\r\n        if (a[i].toUpperCase() === b[i].toUpperCase()) {\r\n          count++;\r\n        } else {\r\n          return count;\r\n        }\r\n      }\r\n\r\n      return count;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  // This will result in the `key` item percolating itself upwards, which is what we want\r\n  // related entries will show up nearby. Anything that is not directly alphabetically related is going to\r\n  // be trouble.\r\n  copy = copy.sort(\r\n    (x, y) => {\r\n      // TODO(jerry or anyone else):  remove this dependency.\r\n      let matched = [matched_characters(x.name, key), matched_characters(y.name, key)];\r\n      if (matched[0] !== 0 || matched[1] !== 0) {\r\n        // Closer matches get pushed forwards.\r\n        if (matched[0] > matched[1]) {\r\n          return -1;\r\n        } else if (matched[0] < matched[1]) {\r\n          return 1;\r\n        } else {\r\n          return -1;\r\n        }\r\n      } else {\r\n        // none of them match the characters...\r\n        // Push them to the back, they are irrelevant.\r\n        if (y !== undefined) {\r\n          if (y < key) {\r\n            return 1;\r\n          } else if (y > key) {\r\n            return 1;\r\n          } else {\r\n            // This is the key itself.\r\n            return -1;\r\n          }\r\n        }\r\n\r\n        if (x < key) {\r\n          return 1;\r\n        } else if (x > key) {\r\n          return 1;\r\n        } else {\r\n          // This is the key itself.\r\n          return -1;\r\n        }\r\n      }\r\n    }\r\n  );\r\n\r\n  return copy;\r\n}\r\n","import styles from 'components/Searchbar/Searchbar.module.scss';\r\nimport { useState, useRef } from 'react';\r\n\r\n\r\nexport default function Searchbar({\r\n  returnInput\r\n}: {\r\n  returnInput: (input: string) => void;\r\n}) {\r\n  const [input, setInput] = useState('');\r\n  const lastTimeTyping = useRef(new Date().getTime());\r\n  const searchbar = useRef<null | HTMLInputElement>(null);\r\n\r\n  return (\r\n    <div id={styles.searchbar}>\r\n      <input\r\n        autoFocus\r\n        type='text'\r\n        placeholder='Search'\r\n        ref={searchbar}\r\n        value={input}\r\n        onChange={(e) => {\r\n          setInput(e.target.value);\r\n          lastTimeTyping.current = new Date().getTime();\r\n          setTimeout(() => {\r\n            if (new Date().getTime() - lastTimeTyping.current >= 500)\r\n              returnInput(e.target.value);\r\n          }, 500);\r\n        }}\r\n      />\r\n      <div id={styles.clearDiv}>\r\n        <span\r\n          id={styles.clear}\r\n          className='material-icons btn'\r\n          onClick={() => {\r\n            setInput('');\r\n            searchbar.current && searchbar.current.focus();\r\n          }}\r\n        >\r\n          clear\r\n        </span>\r\n      </div>\r\n    </div>\r\n  );\r\n}","import styles from 'pages/Header/Search.module.scss';\r\nimport { useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport { useAppSelector } from 'app/hooks';\r\nimport { selectArticlesData, Article } from 'app/articlesSlice';\r\n\r\nimport { validPageLink } from 'utils/functions';\r\nimport MarkdownRender from 'components/Article/MarkdownRender';\r\n\r\nimport Searchbar from 'components/Searchbar/Searchbar';\r\n\r\nexport function renderAsParagraphs(searchResults: Article[]) {\r\n  return searchResults.map(({ name }) =>\r\n    <p key={name}>{name}</p>\r\n  );\r\n}\r\n\r\nexport function renderSearchLink(searchResults: Article[]) {\r\n  return searchResults.map(({ name, content }) => (\r\n    <Link\r\n      key={name}\r\n      to={validPageLink(name)}\r\n    >\r\n      <p>{name}</p>\r\n      <MarkdownRender className={styles.searchResult}>\r\n        {`${content.substr(0, 320).replaceAll(/(@@.*)|(@@.*@@)/g, '')}...`}\r\n      </MarkdownRender>\r\n    </Link>\r\n  ));\r\n}\r\n\r\nexport function renderHoverboxSearch(searchResults: Article[]) {\r\n  return (searchResults.length > 0) ? (\r\n    <div className={styles.hoverBox}>\r\n      {\r\n        searchResults.slice(0, 5).map(({ name }) => (\r\n          <Link\r\n            key={name}\r\n            to={validPageLink(name)}\r\n          >\r\n            <p>{name}</p>\r\n          </Link>))\r\n      }\r\n    </div>\r\n  ) : null;\r\n}\r\n\r\nfunction Search({\r\n  searchFunction, renderFunction\r\n}: {\r\n  searchFunction: (articles: Article[], input: string) => Article[];\r\n  renderFunction: (article: Article[]) => JSX.Element | null;\r\n}) {\r\n  const articlesData = useAppSelector(selectArticlesData);\r\n  const [searchResult, setSearchResult] = useState<Article[]>([]);\r\n\r\n  function returnInputCallback(input: string) {\r\n    setSearchResult(\r\n      input ? searchFunction(\r\n        articlesData.articles.map((article) => article),\r\n        input\r\n      ) : []\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={styles.searchbar}>\r\n      <Searchbar\r\n        returnInput={returnInputCallback}\r\n      />\r\n      {renderFunction(searchResult)}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Search;\r\n","import styles from 'pages/Header/Header.module.scss';\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport { useAppDispatch, useAppSelector } from 'app/hooks';\r\nimport { LoginType, logout, selectLoginType } from 'app/adminSlice';\r\n\r\nimport approximateSearch from 'utils/search';\r\nimport Search, { renderHoverboxSearch } from 'pages/Header/Search';\r\n\r\n\r\nconst Header = () => {\r\n  const dispatch = useAppDispatch();\r\n  const currentLoginType = useAppSelector(selectLoginType);\r\n\r\n  return (\r\n    <header id={styles.header}>\r\n      <Link to=\"/\">\r\n        <div id={styles.logoDiv}></div>\r\n      </Link>\r\n      <Search\r\n        searchFunction={approximateSearch}\r\n        renderFunction={renderHoverboxSearch}\r\n      />\r\n      <nav id={styles.navbar}>\r\n        <button className={'material-icons ' + styles.menu}>\r\n          menu\r\n        </button>\r\n        <button className={styles.links}>\r\n          <Link to='/index'>Index</Link>\r\n          {(\r\n            currentLoginType != LoginType.Anonymous &&\r\n            currentLoginType != LoginType.NotLoggedIn\r\n          ) ? (\r\n            <>\r\n                {\r\n                  (currentLoginType === LoginType.Admin) ?\r\n                    (<Link to=\"/admin\">\r\n                      Create New Article\r\n                    </Link>) :\r\n                    <></>\r\n}\r\n              <button\r\n                onClick={() => {\r\n                  dispatch(logout());\r\n                }}\r\n              >\r\n                Logout\r\n              </button>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Link to=\"/register\">Register</Link>\r\n              <Link to=\"/login\">Login</Link>\r\n            </>\r\n          )}\r\n        </button>\r\n      </nav>\r\n    </header >\r\n  );\r\n};\r\n\r\nexport default Header;\r\n","import styles from 'pages/Homepage/Homepage.module.scss';\r\nimport { randomElt } from 'utils/functions';\r\nimport MarkdownRender from 'components/Article/MarkdownRender';\r\n\r\nimport { ArticlesDataProperties } from 'app/articlesSlice';\r\n\r\nfunction ArticleShowcase({ articlesData: { articles } }: ArticlesDataProperties) {\r\n  const { name, content } = (articles.length) ? randomElt(articles) : { name: \"no article name\", content: \"no articles\" };\r\n  return (\r\n    <>\r\n      <h2>Featured Article</h2>\r\n      <div className={styles.articleDisplay}>\r\n        <p>TODO what is the best way to determine a featured article?</p>\r\n        <p>Honestly, that might have to be manually audited since that depends on a lot of things.</p>\r\n      </div>\r\n      <h2>Random Article</h2>\r\n      <div className={styles.articleDisplay}>\r\n        <h2>{name}</h2>\r\n        <MarkdownRender className={styles.searchResult}>\r\n          {`${content.substr(0, 800).replaceAll(/(@@.*)|(@@.*@@)/g, '')}`}\r\n        </MarkdownRender>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction Homepage({ articlesData }: ArticlesDataProperties) {\r\n  return (\r\n    <>\r\n      <h1>Welcome to Recyclopedia</h1>\r\n      <p>\r\n        Recyclopedia is a freely accessible wiki designed to be a complete source for\r\n        environmentally friendly actions. While it is primarily meant to be a comprehensive\r\n        source of ways to recycle items appropriately. It may also contain other methods of\r\n        sustaining an environmentally friendly lifestyle.\r\n      </p>\r\n      <br></br>\r\n      <p>This is developed by the <a href=\"https://www.projectenv.org/\"><u>Environment Project</u></a></p>\r\n      <br></br>\r\n      <ArticleShowcase articlesData={articlesData}></ArticleShowcase>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default Homepage;","import styles from 'pages/Index/IndexPage.module.scss';\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport { useAppSelector } from 'app/hooks';\r\nimport { selectArticlesData } from 'app/articlesSlice';\r\nimport { LoginType, selectLoginType } from 'app/adminSlice';\r\n\r\nimport { validPageLink } from 'utils/functions';\r\n\r\n\r\nfunction IndexPage() {\r\n  const articlesData = useAppSelector(selectArticlesData);\r\n  const currentLoginType = useAppSelector(selectLoginType);\r\n  const isAdmin = currentLoginType === LoginType.Admin;\r\n\r\n  return (\r\n    <div className={styles.index}>\r\n      {\r\n        (isAdmin) ?\r\n          articlesData.articles.map(({ name, draftStatus }) => (\r\n            <p key={name} >\r\n              <Link to={validPageLink(name)}>\r\n                {(draftStatus) ? \"[DRAFT*] \" + name : name}\r\n              </Link>\r\n            </p>\r\n          ))\r\n          :\r\n          // I should technically not check for undefined, but okay.\r\n          articlesData.articles\r\n            .filter(({ draftStatus }) => draftStatus === false || draftStatus === undefined)\r\n            .map(({ name }) => (\r\n              <p key={name} >\r\n                <Link to={validPageLink(name)}>\r\n                  {name}\r\n                </Link>\r\n              </p>\r\n            ))\r\n      }\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default IndexPage;\r\n","import styles from 'components/Form/Input.module.scss';\r\nimport { useRef } from 'react';\r\n\r\nexport interface InputOptions {\r\n  type?: string,\r\n  placeholder?: string;\r\n  readOnly?: boolean;\r\n  required?: boolean;\r\n\r\n  option?: 'input' | 'textarea';\r\n  label?: string;\r\n  defaultValue?: string,\r\n  selectAllOnFocus?: boolean;\r\n}\r\n\r\nexport type ChangeHandler = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => void;\r\n\r\nconst Input = ({\r\n  changeHandler,\r\n  label,\r\n  defaultValue,\r\n  value,\r\n  option,\r\n  readOnly,\r\n  selectAllOnFocus,\r\n  ...props\r\n}: {\r\n  changeHandler?: ChangeHandler;\r\n  name?: string;\r\n  label?: string;\r\n  value: string;\r\n} & InputOptions\r\n) => {\r\n  const InputOrTextarea = option || 'input';\r\n  const inputRef = useRef<HTMLInputElement & HTMLTextAreaElement>(null);\r\n\r\n  return (\r\n    <div className={styles.group}>\r\n      <InputOrTextarea\r\n        ref={inputRef}\r\n        className={(\r\n          option === 'textarea'\r\n        ) ? styles.textarea\r\n          : styles.input\r\n        }\r\n        onChange={changeHandler}\r\n        {...((\r\n          selectAllOnFocus\r\n        ) && {\r\n          onFocus: () => inputRef.current?.select()\r\n        })}\r\n        {...((\r\n          readOnly\r\n        ) && {\r\n          readOnly: true\r\n        })}\r\n        {...props}\r\n      />\r\n      {\r\n        label && (\r\n          <label\r\n            className={`${value ? styles.shrink : ''}`}\r\n          >\r\n            {label}\r\n          </label>\r\n        )\r\n      }\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Input;\r\n","import { useState, FormEvent } from 'react';\r\n\r\nimport Input, { InputOptions, ChangeHandler } from 'components/Form/Input';\r\n\r\nfunction Form<\r\n  T extends { [name: string]: InputOptions; }\r\n>({\r\n  className,\r\n  submitFn,\r\n  children,\r\n  inputItems\r\n}: {\r\n  className?: string;\r\n  submitFn?: (inputItems: Record<keyof T, string>) => void | boolean | Promise<boolean | void>;\r\n  children?: React.ReactNode;\r\n  inputItems: T;\r\n}) {\r\n\r\n  const defaultItems = Object.assign(\r\n    Object.entries(inputItems).map(([name, value]) => ({\r\n      [name]: value.defaultValue || ''\r\n    }))\r\n  );\r\n\r\n  const [input, setInput] = useState(defaultItems);\r\n\r\n  const changeHandler: ChangeHandler = (e) => {\r\n    const { name, value } = e.target;\r\n\r\n    setInput({\r\n      ...input,\r\n      [name]: value\r\n    });\r\n  };\r\n\r\n  const submitHandler = async (e: FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    const reset = submitFn\r\n      ? await submitFn(input)\r\n      : true;\r\n\r\n    reset && setInput(defaultItems);\r\n  };\r\n\r\n  return (\r\n    <form\r\n      className={className}\r\n      onSubmit={submitHandler}\r\n    >\r\n      {\r\n        Object.entries(inputItems).map(([name, value], idx) => (\r\n          <Input\r\n            key={idx}\r\n            changeHandler={changeHandler}\r\n            name={name}\r\n            value={input[name]}\r\n            {...value}\r\n          />\r\n        ))\r\n      }\r\n      {children}\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default Form;\r\n","import styles from 'App.module.scss';\r\nimport { useEffect } from 'react';\r\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom';\r\n\r\nimport { useAppDispatch, useAppSelector } from 'app/hooks';\r\nimport { initApi, selectStatus, selectArticlesData } from 'app/articlesSlice';\r\nimport { logout, loginWithEmailAndPassword, LoginAttemptResult, LoginType, registerAccount, selectLoginType } from 'app/adminSlice';\r\n\r\nimport { Secrets } from 'secrets';\r\nimport Article from \"components/Article/Article\";\r\n\r\nimport Header from 'pages/Header/Header';\r\nimport Homepage from \"pages/Homepage/Homepage\";\r\nimport IndexPage from \"pages/Index/IndexPage\";\r\nimport Admin from \"pages/Admin/Admin\";\r\nimport { validPageLink } from 'utils/functions';\r\n\r\nimport Form from 'components/Form/Form';\r\nimport Button from 'components/Form/Button'\r\n\r\nfunction RegisterPage(_: {}) {\r\n  const dispatch = useAppDispatch();\r\n  const history = useHistory();\r\n\r\n  return (\r\n    <>\r\n      <h1>Register a New Account</h1>\r\n      <Form\r\n        inputItems={{\r\n          email: {\r\n            selectAllOnFocus: true,\r\n            placeholder: 'Email',\r\n            required: true,\r\n          },\r\n          password: {\r\n            selectAllOnFocus: true,\r\n            placeholder: 'Password',\r\n            required: true,\r\n          },\r\n          passwordConfirmation: {\r\n            selectAllOnFocus: true,\r\n            placeholder: 'Confirm Password',\r\n            required: true,\r\n          }\r\n        }}\r\n        submitFn={async (input) => {\r\n          if (input.password === input.passwordConfirmation) {\r\n              await registerAccount({email: input.email, password: input.password});\r\n          } else {\r\n              alert(\"Passwords do not match!\");\r\n          }\r\n        }}\r\n      >\r\n        <Button type='submit'>Register Account</Button>\r\n      </Form>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction LoginPage(_: {}) {\r\n  const dispatch = useAppDispatch();\r\n  const history = useHistory();\r\n  return (\r\n    <>\r\n      <h1>Login With Your Account!</h1>\r\n      <Form\r\n        inputItems={{\r\n          email: {\r\n            selectAllOnFocus: true,\r\n            placeholder: 'Email',\r\n            required: true,\r\n          },\r\n          password: {\r\n            selectAllOnFocus: true,\r\n            placeholder: 'Password',\r\n            required: true,\r\n          }\r\n        }}\r\n        submitFn={async (input) => {\r\n          const loginResult = (await dispatch(loginWithEmailAndPassword(input))).payload as LoginAttemptResult;\r\n          console.log(loginResult);\r\n\r\n          if (loginResult.type !== LoginType.Anonymous) {\r\n            history.push('/');\r\n          } else {\r\n            alert('bad login');\r\n          }\r\n        }}\r\n      >\r\n        <Button type='submit'>Login</Button>\r\n      </Form>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction App() {\r\n  const articlesData = useAppSelector(selectArticlesData);\r\n  const currentLoginType = useAppSelector(selectLoginType);\r\n\r\n  return (\r\n    <>\r\n      <Header />\r\n\r\n      <main id={styles.main}>\r\n        <Switch>\r\n          <Route exact path='/index'>\r\n            <IndexPage />\r\n          </Route>\r\n          <Route exact path='/'>\r\n            <Homepage articlesData={articlesData} />\r\n          </Route>\r\n          <Route exact path='/admin'>\r\n            {\r\n              (currentLoginType === LoginType.Admin)\r\n                ? <Admin currentArticle={undefined} />\r\n                : <Redirect to='/' />\r\n            }\r\n          </Route>\r\n\r\n          {/*\r\n            For obvious reasons getting ALL the articles is kind of dumb. I believe it\r\n            would be better if we fetched articles on the 404 path.\r\n\r\n            Basically we don't generate the routes here. Rather we kind of hook them up on demand.\r\n\r\n            So the index is still generated with links, and only as much as we need to display a page.\r\n\r\n            Basically that means I have to do something like:\r\n\r\n            bucketSize  = the amount of things we consider to be on a \"page\"\r\n            bucketIndex = the \"page\"\r\n            getArticleInformationPageful(bucketSize: number, bucketIndex: number);\r\n\r\n            IE:\r\n            It's like:\r\n              getAllArticles().slice(bucketIndex * bucketSize, (bucketIndex+1) * bucketSize);\r\n              but since it's on the server side, it reduces the load to send all of them.\r\n\r\n            Then in the wildcard route we simply try to make the article component request the article\r\n            in the URL. If it can't do it, then we just display normal 404.\r\n\r\n            We only have 1 million free api requests from MongoDB so this might ironically be worse since\r\n            each article will take a request from the API (even though it uses less storage space on the\r\n            client side).\r\n          */}\r\n\r\n          {((currentLoginType === LoginType.Admin) ?\r\n            articlesData.articles :\r\n            articlesData.articles.filter((article) => !article.draftStatus))\r\n            .map((article) =>\r\n              <Route key={article.name} exact path={validPageLink(article.name)}>\r\n                <Article article={article} />\r\n              </Route>\r\n            )}\r\n          <Route path=\"/login\">\r\n            <LoginPage />\r\n          </Route>\r\n          <Route path=\"/register\">\r\n            <RegisterPage />\r\n          </Route>\r\n          <Route path='*'>404</Route>\r\n        </Switch>\r\n      </main>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction InitializingApp() {\r\n  const dispatch = useAppDispatch();\r\n  useEffect(() => {\r\n    dispatch(initApi(Secrets.RECYCLOPEDIA_APPLICATION_ID));\r\n  }, [dispatch]);\r\n\r\n  const status = useAppSelector(selectStatus);\r\n\r\n  if (status === 'failed')\r\n    return <p>MongoDB is probably offline. Crap.</p>;\r\n\r\n  if (status === 'succeed')\r\n    return <App />;\r\n\r\n  return <p>Please wait! Loading Recyclopedia...</p>;\r\n}\r\n\r\nexport default InitializingApp;\r\n","import 'index.css';\r\nimport 'styles/global.scss';\r\n\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { BrowserRouter } from 'react-router-dom';\r\n\r\nimport { PersistGate } from 'redux-persist/integration/react';\r\nimport { Provider } from 'react-redux';\r\nimport { store, persistor } from 'app/store';\r\n\r\nimport App from 'App';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <Provider store={store}>\r\n      <PersistGate persistor={persistor}>\r\n        <BrowserRouter basename='/recyclopedia'>\r\n          <App />\r\n        </BrowserRouter>\r\n      </PersistGate>\r\n    </Provider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);","// extracted by mini-css-extract-plugin\nmodule.exports = {\"btn\":\"Header_btn__ixp2s\",\"header\":\"Header_header__2C1Vn\",\"menu\":\"Header_menu__2W5N2\",\"navbar\":\"Header_navbar__1qBL4\",\"logoDiv\":\"Header_logoDiv__3T1yS\",\"links\":\"Header_links__392xQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"title\":\"Article_title__3V4iY\",\"article\":\"Article_article__1_qWg\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"group\":\"Input_group__17cm4\",\"form-input-label\":\"Input_form-input-label__3XeeE\",\"shrink\":\"Input_shrink__1Ejxt\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dropOut\":\"NoticeBanner_dropOut__27qEQ\",\"dropIn\":\"NoticeBanner_dropIn__QXAik\",\"drop-in\":\"NoticeBanner_drop-in__1yqzX\",\"main\":\"NoticeBanner_main__2YpUO\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"active\":\"richWidgetBar_active__1pcNx\",\"button\":\"richWidgetBar_button__N1sVj\",\"main\":\"richWidgetBar_main__14KIW\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"searchbar\":\"Search_searchbar__2GxSQ\",\"hoverBox\":\"Search_hoverBox__3V1C5\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"searchbar\":\"Searchbar_searchbar__2o8go\",\"clearDiv\":\"Searchbar_clearDiv__3C4Bk\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"articleDisplay\":\"Homepage_articleDisplay__3zqNX\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"Button_button__yxyJm\",\"google\":\"Button_google__4WBul\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"btn\":\"App_btn__226iN\",\"main\":\"App_main__3HmsK\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"bottomToolbar_main__2k-V0\"};"],"sourceRoot":""}